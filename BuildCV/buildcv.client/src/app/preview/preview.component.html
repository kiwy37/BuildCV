<!-- BuildCV/buildcv.client/src/app/preview/preview.component.html -->
<div class="preview-container" [class.sidebar-collapsed]="!showCustomizationPanel">
  <!-- Sidebar -->
  <div class="sidebar">
    <app-customize-menu
      [customization]="customization"
      [show]="showCustomizationPanel"
      [selectedTheme]="selectedTheme"
      [zoomPercent]="100"
      (customizationChange)="onCustomizationChange()"
      (reset)="resetCustomization()"
      (exportPdf)="downloadPDF()"
      (back)="backToThemeSelection()"
    ></app-customize-menu>
  </div>

  <!-- Toggle Button -->
  <button
    class="sidebar-toggle"
    (click)="toggleCustomizationPanel()"
    [attr.aria-expanded]="showCustomizationPanel"
  >
    {{ showCustomizationPanel ? "‹" : "›" }}
  </button>

  <!-- PDF Preview Area -->
  <div class="cv-preview-area">
    <!-- Error Message -->
    <div *ngIf="pdfGenerationError" class="pdf-error">
      <i class="icon-alert-circle"></i>
      <span>{{ pdfGenerationError }}</span>
      <button class="btn-retry" (click)="generatePdfPreview()">
        <i class="icon-refresh"></i> Retry
      </button>
    </div>

    <!-- PDF iframe -->
    <iframe
      #pdfIframe
      *ngIf="!pdfGenerationError"
      class="pdf-iframe"
      [src]="pdfBlobUrl | trustUrl"
      (load)="onPdfLoad()"
      frameborder="0"
    ></iframe>

    <!-- Loading overlay -->
    <div *ngIf="(isPdfLoading || isGeneratingPdf) && !pdfGenerationError" class="pdf-loading-overlay">
      <div class="pdf-loading">
        <div class="spinner"></div>
        <span>{{ isGeneratingPdf ? 'Exporting PDF…' : 'Updating preview…' }}</span>
      </div>
    </div>

    <!-- Hidden template container for HTML extraction -->
    <div #templateContainer style="display: none;">
      <app-lima-template
        *ngIf="selectedTheme === 'lima'"
        [cvData]="cvData"
        [customization]="customization"
      ></app-lima-template>

      <app-riga-template
        *ngIf="selectedTheme === 'riga'"
        [cvData]="cvData"
        [customization]="customization"
      ></app-riga-template>

      <app-rotterdam-template
        *ngIf="selectedTheme === 'rotterdam'"
        [cvData]="cvData"
        [customization]="customization"
      ></app-rotterdam-template>

      <app-ats-template
        *ngIf="selectedTheme === 'ats'"
        [cvData]="cvData"
        [customization]="customization"
      ></app-ats-template>
    </div>
  </div>
</div>